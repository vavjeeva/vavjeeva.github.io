<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2">























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"perspectiveLeftIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="PacktPub is one of the great ebook and videos site for tech users and they offer one free ebook everyday. Most of the time, i forget to visit the site so i missed lot of free good ebooks and regret it">
<meta name="keywords" content="Kotlin,Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android App - Free PacktPub Ebook Notifier (Weekend Project)">
<meta property="og:url" content="https://jeevasubburaj.com/2018/04/19/android-app-free-packtpub-ebook/index.html">
<meta property="og:site_name" content="Jeeva Subburaj - Programmer, Blogger">
<meta property="og:description" content="PacktPub is one of the great ebook and videos site for tech users and they offer one free ebook everyday. Most of the time, i forget to visit the site so i missed lot of free good ebooks and regret it">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://4.bp.blogspot.com/-xSGbXptB6yo/WtjfEc1unoI/AAAAAAAGnS4/uZqgkm2LZlglHbgS2LgDs8k5gr-1SNA6gCLcBGAs/s1600/free_ebook_notifier_app.png">
<meta property="og:updated_time" content="2019-03-15T17:32:06.349Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android App - Free PacktPub Ebook Notifier (Weekend Project)">
<meta name="twitter:description" content="PacktPub is one of the great ebook and videos site for tech users and they offer one free ebook everyday. Most of the time, i forget to visit the site so i missed lot of free good ebooks and regret it">
<meta name="twitter:image" content="https://4.bp.blogspot.com/-xSGbXptB6yo/WtjfEc1unoI/AAAAAAAGnS4/uZqgkm2LZlglHbgS2LgDs8k5gr-1SNA6gCLcBGAs/s1600/free_ebook_notifier_app.png">



  <link rel="alternate" href="/atom.xml" title="Jeeva Subburaj - Programmer, Blogger" type="application/atom+xml">




  <link rel="canonical" href="https://jeevasubburaj.com/2018/04/19/android-app-free-packtpub-ebook/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android App - Free PacktPub Ebook Notifier (Weekend Project) | Jeeva Subburaj - Programmer, Blogger</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jeeva Subburaj - Programmer, Blogger</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jeevasubburaj.com/2018/04/19/android-app-free-packtpub-ebook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeeva Subburaj">
      <meta itemprop="description" content="Programmer, Blogger">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jeeva Subburaj - Programmer, Blogger">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Android App - Free PacktPub Ebook Notifier (Weekend Project)

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-19 14:35:00" itemprop="dateCreated datePublished" datetime="2018-04-19T14:35:00-04:00">2018-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-15 13:32:06" itemprop="dateModified" datetime="2019-03-15T13:32:06-04:00">2019-03-15</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2018/04/19/android-app-free-packtpub-ebook/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/04/19/android-app-free-packtpub-ebook/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://www.packtpub.com/" target="_blank" rel="noopener">PacktPub</a> is one of the great ebook and videos site for tech users and they offer one <a href="https://www.packtpub.com/packt/offers/free-learning" target="_blank" rel="noopener">free ebook</a> everyday. Most of the time, i forget to visit the site so i missed lot of free good ebooks and regret it later. So, i decided to create a weekend side project to explore <a href="https://kotlinlang.org/docs/reference/" target="_blank" rel="noopener">kotlin language</a> and also to refresh my android skills by understanding latest <a href="https://developer.android.com/about/versions/oreo/background.html" target="_blank" rel="noopener">andriod O background processing limitations.</a><br><a id="more"></a><br>It took some time to understand the basic kotlin language concepts (like <a href="https://kotlinlang.org/docs/reference/object-declarations.html" target="_blank" rel="noopener">companion objects</a>, <a href="https://kotlinlang.org/docs/reference/null-safety.html" target="_blank" rel="noopener">null safety</a>) but its a good oppertunity for .Net developers to explore this language rather than coding in java for android apps. Kotlin also provides some real <a href="https://kotlinlang.org/docs/tutorials/android-plugin.html" target="_blank" rel="noopener">good extensions plugins</a> to eliminate lot of boilerplate android code like findviewbyid.    </p>
<h3 id="Application-Overview"><a href="#Application-Overview" class="headerlink" title="Application Overview"></a>Application Overview</h3><p><img src="https://4.bp.blogspot.com/-xSGbXptB6yo/WtjfEc1unoI/AAAAAAAGnS4/uZqgkm2LZlglHbgS2LgDs8k5gr-1SNA6gCLcBGAs/s1600/free_ebook_notifier_app.png" alt></p>
<p>This app launches the main activity with asynctask in background to parse the content to get the free ebook title, image url and render it on the main activity. It also check the site periodically (based on settings) and notify the user.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>(),ToolbarManager &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> Tag: String = <span class="string">"MainActivity"</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> parserHelper: ParserHelper</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> alarmManagerHelper: AlarmManagerHelper</span><br><span class="line">    <span class="keyword">var</span> mImageURL: String? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> mTitle: String? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> toolbar <span class="keyword">by</span> lazy &#123; find&lt;toolbar&gt;(R.id.toolbar) &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        initToolbar()</span><br><span class="line">        toolbarTitle = getString(app_name)</span><br><span class="line"> </span><br><span class="line">        claimThisBook.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> intent = Intent(Intent.ACTION_VIEW)</span><br><span class="line">                    .setData(Uri.parse(getString(R.string.FREE_BOOK_URL)))</span><br><span class="line">            startActivity(intent)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Call the Async Task</span></span><br><span class="line">        LoadContentTask().execute()</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Setting the Broadcast Alert</span></span><br><span class="line">        alarmManagerHelper = AlarmManagerHelper(<span class="keyword">this</span>)</span><br><span class="line">        alarmManagerHelper.setBroadCastAlert(<span class="literal">false</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Enable the BootReceiver</span></span><br><span class="line">        enableBootReceiver()</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">enableBootReceiver</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> receiver = ComponentName(<span class="keyword">this</span>, BootReceiver::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">        <span class="keyword">val</span> pm = <span class="keyword">this</span>.packageManager</span><br><span class="line">        pm.setComponentEnabledSetting(receiver,</span><br><span class="line">                PackageManager.COMPONENT_ENABLED_STATE_ENABLED,</span><br><span class="line">                PackageManager.DONT_KILL_APP)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadContentTask</span> : <span class="type">AsyncTask</span>&lt;<span class="type">unit unit=""</span>&gt;</span>() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doInBackground</span><span class="params">(<span class="keyword">vararg</span> p0: <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">            parserHelper = ParserHelper(<span class="keyword">this</span><span class="symbol">@MainActivity</span>);</span><br><span class="line">            <span class="keyword">val</span> (title, imageURL) = parserHelper.parsePacktPubFreeBook()</span><br><span class="line">            mTitle = title</span><br><span class="line">            mImageURL = imageURL</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPostExecute</span><span class="params">(result: <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.onPostExecute(result)</span><br><span class="line">            Glide.with(<span class="keyword">this</span><span class="symbol">@MainActivity</span>).load(mImageURL).into(imageView)</span><br><span class="line">            titleView.text = mTitle</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I have created AlarmManagerHelper class to set the repeating alarm based on the sync frequency settings. The Sync Frequency Settings are stored in SharedPreferences.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">AlarmManagerHelper</span></span>(ctx: Context) : ContextWrapper(ctx) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setBroadCastAlert</span><span class="params">(argRefreshAlarm: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">var</span> refreshAlarm = argRefreshAlarm</span><br><span class="line">        <span class="keyword">val</span> alarmManager = <span class="keyword">this</span>.getSystemService(Activity.ALARM_SERVICE) <span class="keyword">as</span> AlarmManager</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">val</span> notificationIntent = Intent(Constants.ALARM_RECEIVER_INTENT_TRIGGER)</span><br><span class="line">        notificationIntent.setClass(<span class="keyword">this</span>, NotificationReceiver::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">var</span> pendingIntent = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, notificationIntent, PendingIntent.FLAG_NO_CREATE)</span><br><span class="line">        <span class="keyword">if</span> (pendingIntent == <span class="literal">null</span>) &#123;</span><br><span class="line">            pendingIntent = PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT)</span><br><span class="line">            refreshAlarm = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (refreshAlarm) &#123;</span><br><span class="line">            <span class="keyword">val</span> syncFrequency: String <span class="keyword">by</span> DelegatesExt.preference(<span class="keyword">this</span>, Constants.SYNC_FREQUENCY_NAME, Constants.SYNC_FREQUENCY_DEFAULT_VALUE)</span><br><span class="line">            <span class="keyword">val</span> syncFrequencyLong = syncFrequency.toLong()</span><br><span class="line">            <span class="keyword">var</span> finalCalInMillis: <span class="built_in">Long</span> = System.currentTimeMillis() + (syncFrequencyLong * AlarmManager.INTERVAL_HOUR)</span><br><span class="line">            alarmManager.setRepeating(AlarmManager.RTC_WAKEUP, finalCalInMillis, (syncFrequencyLong * AlarmManager.INTERVAL_HOUR) , pendingIntent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>From Android O, there are lot of limitations on <a href="https://developer.android.com/about/versions/oreo/background.html" target="_blank" rel="noopener">background execution limits</a> and you can read all those details in <a href="https://developer.android.com/about/versions/oreo/background.html" target="_blank" rel="noopener">android developer guide</a>. For this project, i need a background job that should run periodically based on frequency settings defined in the app and send the notification to user with the book title. I used JobIntentService to do the background work and send the notification to user</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotificationService</span> : <span class="type">JobIntentService</span></span>() &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> notiHelper: NotificationHelper</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> parserHelper: ParserHelper</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> JOB_ID = <span class="number">1000</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> NOTI_PRIMARY = <span class="number">1100</span></span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">enqueueWork</span><span class="params">(ctx: <span class="type">Context</span>, intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line">            enqueueWork(ctx, NotificationService::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>, <span class="type">JOB_ID</span>, <span class="type">intent)</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHandleWork</span><span class="params">(intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line"> </span><br><span class="line">        notiHelper = NotificationHelper(<span class="keyword">this</span>)</span><br><span class="line">        parserHelper = ParserHelper(<span class="keyword">this</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">val</span>(title) = parserHelper.parsePacktPubFreeBook()</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">val</span> pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, <span class="number">0</span>)</span><br><span class="line">        notiHelper.notify(NOTI_PRIMARY, notiHelper.getNotification(getString(R.string.noti_title), title,pendingIntent))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I also created BootReceiver with BOOT_COMPLETED intent so that repeating alarm will get set even in the event of phone is restarted.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BootReceiver</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> alarmManagerHelper: AlarmManagerHelper</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>, intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (intent.action == <span class="string">"android.intent.action.BOOT_COMPLETED"</span>) &#123;</span><br><span class="line">            alarmManagerHelper = AlarmManagerHelper(context)</span><br><span class="line">            alarmManagerHelper.setBroadCastAlert(<span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I used <a href="https://jsoup.org/" target="_blank" rel="noopener">Jsoup Library</a> to parse the HTML content. Jsoup is a Java library for working with real-world HTML. It provides a very convenient API for extracting and manipulating data, using the best of DOM, CSS, and jquery-like methods.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">ParserHelper</span></span>(ctx: Context) : ContextWrapper(ctx) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> tag: String = <span class="string">"ParserHelper"</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">ParserEntity</span></span>(<span class="keyword">val</span> title: String, <span class="keyword">val</span> imageURL: String?)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">parsePacktPubFreeBook</span><span class="params">()</span></span>: ParserEntity &#123;</span><br><span class="line">        <span class="keyword">var</span> title = <span class="string">"Internet access not available"</span></span><br><span class="line">        <span class="keyword">var</span> imageURL: String? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">if</span> (isInternetConnected()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> htmlContent = Jsoup.connect(getString(R.string.FREE_BOOK_URL)).<span class="keyword">get</span>()</span><br><span class="line">                title = htmlContent.select(<span class="string">"div[class=dotd-title]"</span>).text()</span><br><span class="line">                imageURL = <span class="string">"http:"</span> + htmlContent.select(<span class="string">"img[class=bookimage imagecache imagecache-dotd_main_image]"</span>).attr(<span class="string">"src"</span>)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                Log.e(tag, <span class="string">"Error in fetching the content "</span> + e.printStackTrace())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> ParserEntity(title, imageURL)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">isInternetConnected</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> cm = <span class="keyword">this</span>.getSystemService(Context.CONNECTIVITY_SERVICE) <span class="keyword">as</span> ConnectivityManager</span><br><span class="line">        <span class="keyword">val</span> activeNetwork = cm.activeNetworkInfo</span><br><span class="line">        <span class="keyword">return</span> activeNetwork != <span class="literal">null</span> &amp;&amp; activeNetwork.isConnectedOrConnecting</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So, overall this project will give you the idea of how to develop an android app in kotlin including running the background job and send the notitfication to users. I have uploaded the entire source code in <a href="https://github.com/vavjeeva/FreeEBookNotifier" target="_blank" rel="noopener">github</a>.  </p>
<p>Happy Coding</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/05/net-hidden-gems-webdebugconfig-and/" rel="next" title=".Net Hidden Gems - Web.Debug.Config and Web.Release.Config">
                <i class="fa fa-chevron-left"></i> .Net Hidden Gems - Web.Debug.Config and Web.Release.Config
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/27/sql-server-tips-sql-server-paging-made/" rel="prev" title="SQL Server Tips : SQL Server Paging made easy with OFFSET and FETCH Keyword">
                SQL Server Tips : SQL Server Paging made easy with OFFSET and FETCH Keyword <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Jeeva Subburaj">
            
              <p class="site-author-name" itemprop="name">Jeeva Subburaj</p>
              <div class="site-description motion-element" itemprop="description">Programmer, Blogger</div>
          </div>

          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/vavjeeva" title="GitHub &rarr; https://github.com/vavjeeva" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:vavjeeva@gmail.com" title="E-Mail &rarr; mailto:vavjeeva@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/vavjeeva" title="Twitter &rarr; https://twitter.com/vavjeeva" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://linkedin.com/in/jeevasubburaj" title="LinkedIn &rarr; https://linkedin.com/in/jeevasubburaj" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i>LinkedIn</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://stackoverflow.com/users/79442/jeeva-subburaj" title="StackOverflow &rarr; https://stackoverflow.com/users/79442/jeeva-subburaj" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
	  
	  
		<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
		<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
		<div class="widget-wrap">			
			<div id="myCanvasContainer" class="widget tagcloud">
				<canvas width="250" height="250" id="resCanvas" style="width=100%">
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Net/">.Net</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Net-Core/">.Net Core</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Asp-Net-Core/">Asp.Net Core</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure/">Azure</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AzureFunctions/">AzureFunctions</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CognitiveService/">CognitiveService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HiddenGems/">HiddenGems</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HttpClient/">HttpClient</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJS/">NodeJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/">Performance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-PI/">Raspberry PI</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL-Server/">SQL Server</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SignalR/">SignalR</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tips/">Tips</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xamarin/">Xamarin</a><span class="tag-list-count">1</span></li></ul>
				</canvas>
			</div>
		</div>
		

      	  	  
    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeeva Subburaj</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://jeevasubburaj.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://jeevasubburaj.com/2018/04/19/android-app-free-packtpub-ebook/";
    this.page.identifier = "2018/04/19/android-app-free-packtpub-ebook/";
    this.page.title = 'Android App - Free PacktPub Ebook Notifier (Weekend Project)';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://jeevasubburaj.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    $(function() {
      var offsetTop = $('#comments').offset().top - $(window).height();
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        loadComments();
      } else {
        $(window).on('scroll.disqus_scroll', function() {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = $('#comments').offset().top - $(window).height();
          var scrollTop = $(window).scrollTop();

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            $(window).off('.disqus_scroll');
            loadComments();
          }
        });
      }
    });
  
</script>





  


  




  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


</body>
</html>
